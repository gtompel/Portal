# Middleware Setup - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## ‚úÖ –ß—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

Middleware –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –ø—Ä–æ–µ–∫—Ç –∏ –≤–∫–ª—é—á–∞–µ—Ç:

- üîê **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —á–µ—Ä–µ–∑ NextAuth.js JWT
- üõ°Ô∏è **Security Headers** (CSP, XSS Protection, etc.)
- üåê **CORS** –¥–ª—è API —Ä–æ—É—Ç–æ–≤
- üìä **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ development
- ‚ö° **Rate Limiting** (100 –∑–∞–ø—Ä–æ—Å–æ–≤/15 –º–∏–Ω)
- üéØ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π matcher** –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ó–∞—â–∏—â–∞–µ—Ç –≤—Å–µ —Ä–æ—É—Ç—ã `/tasks`, `/projects`, `/employees`, etc.
- –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–µ —Ä–æ—É—Ç—ã `/auth/*`, `/api/auth`
- –î–æ–±–∞–≤–ª—è–µ—Ç security headers –∫–æ –≤—Å–µ–º –æ—Ç–≤–µ—Ç–∞–º
- –õ–æ–≥–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ development —Ä–µ–∂–∏–º–µ

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Production

1. **–û–±–Ω–æ–≤–∏—Ç–µ CORS –¥–æ–º–µ–Ω—ã** –≤ `lib/middleware-utils.ts`:
```typescript
origin: process.env.NODE_ENV === 'production' 
  ? ['https://yourdomain.com'] // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
  : ['http://localhost:3000', 'http://127.0.0.1:3000'],
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
```env
NEXTAUTH_SECRET=your-secret-key
NEXTAUTH_URL=https://yourdomain.com
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
‚îú‚îÄ‚îÄ middleware.ts              # –û—Å–Ω–æ–≤–Ω–æ–π middleware
‚îú‚îÄ‚îÄ lib/middleware-utils.ts    # –£—Ç–∏–ª–∏—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ types/middleware.ts        # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ docs/middleware.md         # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ MIDDLEWARE_SETUP.md        # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üîß –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–æ—É—Ç–æ–≤

### –ü—É–±–ª–∏—á–Ω—ã–π —Ä–æ—É—Ç:
```typescript
// middleware.ts
const PUBLIC_ROUTES = [
  '/auth/login',
  '/new-public-route', // –î–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å
]
```

### –ó–∞—â–∏—â–µ–Ω–Ω—ã–π —Ä–æ—É—Ç:
```typescript
// middleware.ts
const PROTECTED_ROUTES = [
  '/dashboard',
  '/new-protected-route', // –î–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å
]
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í development —Ä–µ–∂–∏–º–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:
```
[2024-01-15T10:30:00.000Z] GET /tasks - IP: 127.0.0.1 - UA: Mozilla/5.0...
```

## üÜò Troubleshooting

### –û—à–∏–±–∫–∞ 401 Unauthorized
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `NEXTAUTH_SECRET` –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–æ—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤

### –û—à–∏–±–∫–∞ 429 Too Many Requests
- –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç –≤ `checkRateLimit` —Ñ—É–Ω–∫—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ IP –∞–¥—Ä–µ—Å –≤ –ª–æ–≥–∞—Ö

### –ü—Ä–æ–±–ª–µ–º—ã —Å CORS
- –û–±–Ω–æ–≤–∏—Ç–µ `corsConfig.origin` –≤ `middleware-utils.ts`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ Network tab –±—Ä–∞—É–∑–µ—Ä–∞

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ `docs/middleware.md` 